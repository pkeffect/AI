# Open-WebUI-Dev-Cuda | https://github.com/open-webui/open-webui
# Searxng | https://github.com/searxng/searxng
# Pipelines | https://github.com/open-webui/pipelines

services:
#  ollama: # Installed locally in Windows 11 this setup.
#    volumes:
#      - H:/ai/.ollama:/root/.ollama
#    container_name: ollama
#    pull_policy: always
#    tty: true
#    restart: unless-stopped
#    image: ollama/ollama:0.2.8-rc2
    # GPU support
#    deploy:
#      resources:
#        reservations:
#          devices:
#            - driver: nvidia
#              count: 1
#              capabilities:
#                - gpu
#    networks:
#      - "hyperspace"
      
  open-webui-dev-cuda:
    image: ghcr.io/open-webui/open-webui:dev-cuda # development CUDA image; may want to use ghcr.io/open-webui/open-webui:latest
    container_name: open-webui-dev-cuda
    stdin_open: true
    tty: true    
    ports:
      - "3000:8080"
    volumes:
      - ./.data-open-webui:/app/backend/data # locally mounted directory, not the default docker volume
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities:
                - gpu      
    extra_hosts:
      - "host.docker.internal:host-gateway"     
    environment:
      - 'SCARF_NO_ANALYTICS=${SCARF_NO_ANALYTICS}'
      - 'DO_NOT_TRACK=${DO_NOT_TRACK}'
      - 'ANONYMIZED_TELEMETRY=${ANONYMIZED_TELEMETRY}'
      - 'OLLAMA_BASE_URL=${OLLAMA_BASE_URL}'
      - 'WEBUI_SECRET_KEY=${WEBUI_SECRET_KEY}'
      - 'USE_CUDA_DOCKER=${USE_CUDA_DOCKER}'
      - 'COMFYUI_BASE_URL=${COMFYUI_BASE_URL}'
      - 'AUTOMATIC1111_BASE_URL=${AUTOMATIC1111_BASE_URL}'
    restart: always
    networks:
      - "hyperspace" # custom docker network

  searxng:
    image: searxng/searxng:latest
    container_name: open-webui-searxng
    ports:
      - "4000:8080"      
    volumes:
      - ./.data-searxng:/etc/searxng:rw # locally mounted directory, not the default docker volume
    depends_on:
      - open-webui-dev-cuda       
    restart: always  
    networks:
      - "hyperspace" # custom docker network
      
  pipelines:
    image: ghcr.io/open-webui/pipelines:main 
    container_name: open-webui-pipelines
    ports:
      - "9099:9099"
#    environment:
#      ANTHROPIC_API_KEY: "${ANTHROPIC_API_KEY}"
#      COHERE_API_KEY: "${COHERE_API_KEY}"
#      GOOGLE_API_KEY: "${GOOGLE_API_KEY}"
#      PIPELINES_URLS: "${PIPELINES_URLS}"
    volumes:
      - ./.data-pipelines:/app/pipelines # locally mounted directory, not the default docker volume
    depends_on:
      - open-webui-dev-cuda    
    restart: always
    networks:
      - "hyperspace" # custom docker network
  
networks:
  hyperspace:
    external: true
